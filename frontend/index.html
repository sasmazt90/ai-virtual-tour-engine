<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Virtual Tour Viewer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #viewer {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
    }

    #scene-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .hotspot {
      position: absolute;
      width: 18px;
      height: 18px;
      background: rgba(0, 160, 255, 0.9);
      border-radius: 50%;
      cursor: pointer;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px rgba(0,160,255,0.9);
    }

    .hotspot:hover {
      background: rgba(255, 200, 0, 1);
    }

    #scene-label {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      background: rgba(0,0,0,0.6);
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<div id="viewer">
  <div id="scene-label"></div>
  <img id="scene-image" />
</div>

<script>
/* ============================
   1) BACKEND'DEN GELEN JSON
   ============================ */

const TOUR_DATA = {
  "scenes": [
    {
      "id": "scene_1",
      "image": "/app/uploads/9bd0b85e-6001-4eac-8373-44c5bcfb380d.png",
      "hotspots": [
        {
          "id": "h1",
          "x": 50,
          "y": 55,
          "target_image": "/app/uploads/1b080306-f0e1-4853-b050-24548eb3c0b4.png"
        }
      ]
    }
  ]
};

/* ============================
   2) STATE
   ============================ */

let currentScene = null;
const viewer = document.getElementById("viewer");
const imgEl = document.getElementById("scene-image");
const labelEl = document.getElementById("scene-label");

/* ============================
   3) SCENE BULUCU
   ============================ */

function findSceneByImage(imagePath) {
  return TOUR_DATA.scenes.find(s => s.image === imagePath);
}

/* ============================
   4) SCENE RENDER
   ============================ */

function renderScene(scene) {
  currentScene = scene;

  // label
  labelEl.innerText = scene.id;

  // image
  imgEl.src = scene.image;

  // eski hotspotları sil
  document.querySelectorAll(".hotspot").forEach(h => h.remove());

  // hotspotları çiz
  scene.hotspots.forEach(h => {
    const dot = document.createElement("div");
    dot.className = "hotspot";

    dot.style.left = h.x + "%";
    dot.style.top  = h.y + "%";

    dot.onclick = () => {
      const targetScene = findSceneByImage(h.target_image);
      if (targetScene) {
        renderScene(targetScene);
      } else {
        // hedef image scene değilse direkt göster
        imgEl.src = h.target_image;
      }
    };

    viewer.appendChild(dot);
  });
}

/* ============================
   5) BAŞLAT
   ============================ */

renderScene(TOUR_DATA.scenes[0]);

</script>
</body>
</html>
